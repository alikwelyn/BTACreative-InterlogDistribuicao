(function ($) {
    "use strict";
    $(function () {
        $('.wpcf7-field-group-add').wrapAll('<div class="wpcf7-field-group-button-a d-flex justify-content-center"></div>');
        $('.wpcf7-field-group-remove').wrapAll('<div class="wpcf7-field-group-button-r d-flex justify-content-end"></div>');
        var $groups = $(".wpcf7-field-groups");
        if ($groups.length) {
            $groups.each(function () {
                $(this).data("group-model", $(this).find(".wpcf7-field-group").eq(0).clone());
            });
            $("body").on("wpcf7-field-groups/change", ".wpcf7-field-groups", function () {
                var $groupsInside = $(this).find(".wpcf7-field-group");
                $groupsInside.each(function (index) {
                    $(this)
                        .find(".wpcf7-field-group-remove")
                        .toggle(index > 0)
                        .end()
                        .prev(".wpcf7-field-group")
                        .find(".wpcf7-field-group-add")
                        .hide();
                    var i = index + 1;
                    $(this)
                        .find("[name]")
                        .each(function () {
                            var $$ = $(this),
                                $formControlWrap = $$.closest(".wpcf7-form-control-wrap"),
                                name = $$.attr("name"),
                                isArray = name.indexOf("[]") > -1,
                                rawName = name.replace("[]", "");
                            var newName = rawName.replace(/__[0-9]*/, "") + "__" + i;
                            if ($formControlWrap.length && !$formControlWrap.hasClass(newName)) {
                                $formControlWrap.removeClass(rawName).addClass(newName);
                            }
                            newName += isArray ? "[]" : "";
                            $$.attr("name", newName);
                        });
                });
                $(this).find(".wpcf7-field-group-count").val($groupsInside.length);
            });
            $groups.trigger("wpcf7-field-groups/change");
            $("body").on("click", ".wpcf7-field-group-add, .wpcf7-field-group-remove", function () {
                var $$ = $(this),
                    $allGroups = $$.closest(".wpcf7-field-groups");
                if ($$.hasClass("wpcf7-field-group-add")) {
                    var $newGroup = $allGroups.data("group-model").clone(true);
                    $allGroups.append($newGroup);
                    $$.trigger("wpcf7-field-groups/added", $newGroup);
                } else {
                    $$.trigger("wpcf7-field-groups/removed").closest('.wpcf7-field-group').prev('.wpcf7-field-group').find('.wpcf7-field-group-button-a .wpcf7-field-group-add').show();
                    $$.closest(".wpcf7-field-group").remove();
                }
                $allGroups.trigger("wpcf7-field-groups/change");
                return false;
            });
            $groups.on("click", ".wpcf7-exclusive-checkbox input:checkbox", function () {
                var name = $(this).attr("name");
                $groups
                    .find('input:checkbox[name="' + name + '"]')
                    .not(this)
                    .prop("checked", false);
            });
        }
    });
})(jQuery);
